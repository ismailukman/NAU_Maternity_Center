generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Authentication & User Management
model User {
  id                String    @id @default(uuid())
  email             String?   @unique
  phone             String    @unique
  password          String
  role              String    @default("PATIENT")

  firstName         String
  lastName          String
  dateOfBirth       DateTime
  gender            String
  profileImage      String?

  isActive          Boolean   @default(true)
  isVerified        Boolean   @default(false)
  lastLogin         DateTime?

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  patient           Patient?
  doctor            Doctor?
  appointmentsCreated Appointment[] @relation("CreatedBy")
}

// Patient Management (Maternity-focused)
model Patient {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  patientId               String   @unique

  alternatePhone          String?
  address                 String
  city                    String?
  state                   String

  bloodGroup              String?
  genotype                String?
  allergies               String?
  chronicConditions       String?

  emergencyContactName    String
  emergencyContactPhone   String
  emergencyContactRelation String

  // Maternity-specific
  isPregnant              Boolean  @default(false)
  expectedDeliveryDate    DateTime?
  pregnancyWeek           Int?
  numberOfPregnancies     Int      @default(0)
  numberOfChildren        Int      @default(0)

  consentDataProcessing   Boolean  @default(false)
  consentSMSReminders     Boolean  @default(false)

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  appointments            Appointment[]
  pregnancyRecords        PregnancyRecord[]
  children                Child[]
}

// Maternity Doctor Profiles
model Doctor {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  doctorId                String   @unique
  licenseNumber           String   @unique
  qualification           String
  specialization          String
  subSpecialty            String?
  yearsOfExperience       Int

  department              String
  position                String

  consultationFee         Float
  followUpFee             Float?
  consultationDuration    Int      @default(30)

  workingDays             String
  workingHours            String

  languages               String

  averageRating           Float    @default(0)
  totalReviews            Int      @default(0)
  totalPatientsSeen       Int      @default(0)

  bio                     String?

  isAcceptingPatients     Boolean  @default(true)
  isOnLeave               Boolean  @default(false)

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  appointments            Appointment[]
  reviews                 DoctorReview[]
}

model DoctorReview {
  id          String   @id @default(uuid())
  doctorId    String
  doctor      Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  patientId   String

  rating      Int
  comment     String?

  isPublic    Boolean  @default(true)

  createdAt   DateTime @default(now())
}

// Appointment Management
model Appointment {
  id                  String    @id @default(uuid())
  appointmentNumber   String    @unique

  patientId           String
  patient             Patient   @relation(fields: [patientId], references: [id])
  doctorId            String
  doctor              Doctor    @relation(fields: [doctorId], references: [id])

  appointmentType     String
  specialtyId         String
  appointmentDate     DateTime
  appointmentTime     String
  duration            Int       @default(30)

  status              String    @default("SCHEDULED")

  reasonForVisit      String
  symptoms            String?
  previousVisit       Boolean   @default(false)

  consultationFee     Float
  totalAmount         Float
  paymentStatus       String    @default("PENDING")

  checkedIn           Boolean   @default(false)
  checkInTime         DateTime?
  queueNumber         String?

  doctorNotes         String?
  diagnosis           String?
  prescription        String?
  followUpRequired    Boolean?
  followUpDate        DateTime?

  cancellationReason  String?
  cancelledAt         DateTime?

  createdById         String
  createdBy           User      @relation("CreatedBy", fields: [createdById], references: [id])

  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

// Maternity-specific: Pregnancy Records
model PregnancyRecord {
  id                  String   @id @default(uuid())
  patientId           String
  patient             Patient  @relation(fields: [patientId], references: [id])

  pregnancyNumber     Int
  lastMenstrualPeriod DateTime
  expectedDeliveryDate DateTime
  currentWeek         Int

  bloodPressure       String?
  weight              Float?
  fundalHeight        String?
  fetalHeartRate      Int?

  complications       String?
  notes               String?

  visitDate           DateTime
  nextVisitDate       DateTime?

  createdAt           DateTime @default(now())
}

// Children Records (for postnatal care)
model Child {
  id                  String   @id @default(uuid())
  motherId            String
  mother              Patient  @relation(fields: [motherId], references: [id])

  childId             String   @unique
  firstName           String
  lastName            String
  dateOfBirth         DateTime
  gender              String

  birthWeight         Float?
  birthLength         Float?
  bloodGroup          String?

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  vaccinations        Vaccination[]
}

// Vaccination Records
model Vaccination {
  id                  String   @id @default(uuid())
  childId             String
  child               Child    @relation(fields: [childId], references: [id])

  vaccineName         String
  vaccineType         String
  dateAdministered    DateTime
  nextDueDate         DateTime?

  administeredBy      String?
  batchNumber         String?
  notes               String?

  createdAt           DateTime @default(now())
}

// Admin Model for authenticated admin users
model Admin {
  id                  String    @id @default(uuid())
  email               String    @unique
  password            String
  firstName           String
  lastName            String
  phone               String?
  role                String    @default("ADMIN")

  isActive            Boolean   @default(true)
  lastLogin           DateTime?

  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}
